@using BookStoreEcommerce.Models.Entities  
@model IEnumerable<Order>  
@{  
    ViewData["Title"] = "My Orders";  
}  

<h2>My Orders</h2>  

@if (Model.Any())  
{  
    <div class="table-responsive">  
        <table class="table table-striped">  
            <thead>  
                <tr>  
                    <th>Order Number</th>  
                    <th>Date</th>  
                    <th>Total Amount</th>  
                    <th>Status</th>  
                    <th>Payment Status</th>  
                    <th>Actions</th>  
                </tr>  
            </thead>  
            <tbody>  
                @foreach (var order in Model)  
                {  
                    <tr>  
                        <td>@order.OrderNumber</td>  
                        <td>@order.OrderDate.ToString("MMM dd, yyyy")</td>  
                        <td>$@order.TotalAmount</td>  
                        <td>  
                            <span class="badge bg-@(order.OrderStatus switch {  
                                OrderStatus.Pending => "warning",  
                                OrderStatus.Processing => "info",  
                                OrderStatus.Shipped => "primary",  
                                OrderStatus.Delivered => "success",  
                                OrderStatus.Cancelled => "danger",  
                                _ => "secondary"  
                            })">  
                                @order.OrderStatus  
                            </span>  
                        </td>  
                        <td>  
                            <span class="badge bg-@(order.PaymentStatus switch {  
                                PaymentStatus.Pending => "warning",  
                                PaymentStatus.Paid => "success",  
                                PaymentStatus.Failed => "danger",  
                                PaymentStatus.Refunded => "info",  
                                _ => "secondary"  
                            })">  
                                @order.PaymentStatus  
                            </span>  
                        </td>  
                        <td>  
                            <a asp-action="Details" asp-route-id="@order.OrderId" class="btn btn-sm btn-outline-primary">View</a>  
                            @if (order.OrderStatus == OrderStatus.Pending)  
                            {  
                                <button class="btn btn-sm btn-outline-danger" onclick="cancelOrder(@order.OrderId)">Cancel</button>  
                            }  
                        </td>  
                    </tr>  
                }  
            </tbody>  
        </table>  
    </div>  
}  
else  
{  
    <div class="text-center">  
        <h4>No orders found</h4>  
        <p>You haven't placed any orders yet.</p>  
        <a asp-controller="Book" asp-action="Index" class="btn btn-primary">Start Shopping</a>  
    </div>  
}  

@section Scripts {  
    <script>  
        function cancelOrder(orderId) {  
            if (confirm('Are you sure you want to cancel this order?')) {  
                $.post('/Order/Cancel', { id: orderId }, function(data) {  
                    if (data.success) {  
                        alert(data.message);  
                        location.reload();  
                    } else {  
                        alert(data.message);  
                    }  
                });  
            }  
        }  
    </script>  
}
